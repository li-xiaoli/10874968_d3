for(var xData=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],selectedYear=2010,dataset=[],dataMean=[],days=[],i=0;4>=i;i++)dataMean[i]=[0,0,0,0,0,0,0,0,0,0,0,0],days[i]=[0,0,0,0,0,0,0,0,0,0,0,0];var w=700,h=300,svg=d3.select("svg"),converting=function(a){return"-"===a[0]?-1*parseInt(a.substring(1)):parseInt(a)},fixing=function(a){for(var t=0;t<a.length;t++){console.log(a[t]),a[t].temperature=converting(a[t].temperature),a[t].month=converting(a[t].month);for(var e=2010;2014>=e;e++)if(Number(a[t].year)===e)switch(a[t].month){case 1:dataMean[e-2010][0]+=a[t].temperature,days[e-2010][0]++;break;case 2:dataMean[e-2010][1]+=a[t].temperature,days[e-2010][1]++;break;case 3:dataMean[e-2010][2]+=a[t].temperature,days[e-2010][2]++;break;case 4:dataMean[e-2010][3]+=a[t].temperature,days[e-2010][3]++;break;case 5:dataMean[e-2010][4]+=a[t].temperature,days[e-2010][4]++;break;case 6:dataMean[e-2010][5]+=a[t].temperature,days[e-2010][5]++;break;case 7:dataMean[e-2010][6]+=a[t].temperature,days[e-2010][6]++;break;case 8:dataMean[e-2010][7]+=a[t].temperature,days[e-2010][7]++;break;case 9:dataMean[e-2010][8]+=a[t].temperature,days[e-2010][8]++;break;case 10:dataMean[e-2010][9]+=a[t].temperature,days[e-2010][9]++;break;case 11:dataMean[e-2010][10]+=a[t].temperature,days[e-2010][10]++;break;case 12:dataMean[e-2010][11]+=a[t].temperature,days[e-2010][11]++;break;default:console.log("-----------------------------------13")}}for(var e=2010;2014>=e;e++)for(var r=1;12>=r;r++)dataMean[e-2010][r-1]=Math.round(100*dataMean[e-2010][r-1]/days[e-2010][r-1])/100},displayData=function(a){console.log("displayData "),console.log(dataMean[a-2010]),svg.attr("width",w).attr("height",h),svg.selectAll("rect").data(dataMean[a-2010]).enter().append("rect").attr("x",function(a,t){return 33*t+160}).attr("y",function(a){return a>=0?h-30-1*a:h-30}).attr("width",30).attr("height",function(a){return a>=0?1*a:-1*a}).attr("fill","#72EDF2"),svg.selectAll("text").data(dataMean[a-2010]).enter().append("text").attr("x",function(a,t){return 33*t+160}).attr("y",function(a){return a>=0?h-30-1*a-3:h-30-3}).text(function(a){return a}).attr("font-size",8);var t=150,e=d3.scale.linear().domain([0,230]).range([230,0]),r=d3.svg.axis().scale(e).orient("left").ticks(6);svg.append("g").attr("class","axis").attr("transform","translate("+t+",40)").call(r)},changeYear=function(a){console.log(a),selectedYear=Number(a),svg.selectAll("rect").data(dataMean[selectedYear-2010]).transition().duration(1e3).ease("linear").attr("x",function(a,t){return 33*t+160}).attr("y",function(a){return a>=0?h-30-1*a:h-30}).attr("width",30).attr("height",function(a){return a>=0?1*a:-1*a}).attr("fill","#72EDF2"),svg.selectAll("text").remove(),svg.selectAll("text").data(dataMean[selectedYear-2010]).enter().append("text").attr("x",function(a,t){return 33*t+160}).attr("y",function(a){return a>=0?h-30-1*a-3:h-30-3}).text(function(a){return a}).attr("font-size",8);var t=150,e=d3.scale.linear().domain([0,230]).range([230,0]),r=d3.svg.axis().scale(e).orient("left").ticks(6);svg.append("g").attr("class","axis").attr("transform","translate("+t+",40)").call(r)};d3.csv("meteo.csv",function(a){console.table(a),dataset=a,fixing(dataset),console.table(dataMean),displayData(2010)});